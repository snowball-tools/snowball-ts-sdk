{"version":3,"file":"Snowball.js","sourceRoot":"","sources":["../../../src/snowball/Snowball.ts"],"names":[],"mappings":";;;AAMA,sCAAwC;AAExC,6CAAkD;AAwBlD,MAAa,QAAQ;IASnB,YACE,OAAe,EACf,KAAY,EACZ,gBAAkC,EAClC,uBAAgD;QAZ1C;;;;;WAAa;QACb;;;;;WAAmC;QACnC;;;;;WAAiD;QAElD;;;;;WAAmB;QACnB;;;;;WAA6C;QAC7C;;;;;WAA0C;QAQ/C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QACzC,IAAI,CAAC,uBAAuB,GAAG,uBAAuB,CAAC;QAEvD,IAAI,CAAC,IAAI,GAAG,IAAI,yBAAe,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACnE,IAAI,CAAC,eAAe,EAAE;aACnB,IAAI,CAAC,CAAC,YAAY,EAAE,EAAE;YACrB,IAAI,CAAC,WAAW,GAAG,IAAI,oBAAW,CAChC,YAAY,EACZ,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,uBAAuB,CAC7B,CAAC;QACJ,CAAC,CAAC;aACD,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;YACf,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,KAAK,CAAC,eAAe;QACnB,IAAI;YACF,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;SAC1C;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,OAAO,CAAC,MAAM,CAAC,0BAA0B,KAAK,EAAE,CAAC,CAAC;SAC1D;IACH,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,KAAY;QAC5B,IAAI;YACF,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;SACzB;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,OAAO,CAAC,MAAM,CAAC,sBAAsB,KAAK,EAAE,CAAC,CAAC;SACtD;IACH,CAAC;IAED,KAAK,CAAC,UAAU;QACd,IAAI;YACF,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,EAAE;gBAClC,IAAI,CAAC,YAAY,GAAG,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;gBACjD,IAAI,CAAC,WAAW,GAAG,IAAI,oBAAW,CAChC,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,uBAAuB,CAC7B,CAAC;aACH;YACD,OAAO,MAAM,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;SAC5C;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,OAAO,CAAC,MAAM,CAAC,qBAAqB,KAAK,EAAE,CAAC,CAAC;SACrD;IACH,CAAC;IAED,KAAK,CAAC,iBAAiB,CACrB,aAAsB,EACtB,IAAS,EACT,UAAmB;QAInB,IAAI;YACF,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,EAAE;gBAClC,IAAI,CAAC,YAAY,GAAG,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;gBACjD,IAAI,CAAC,WAAW,GAAG,IAAI,oBAAW,CAChC,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,uBAAuB,CAC7B,CAAC;aACH;YACD,OAAO,MAAM,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAC7C,aAAa,EACb,IAAI,EACJ,UAAU,CACX,CAAC;SACH;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,OAAO,CAAC,MAAM,CAAC,4BAA4B,KAAK,EAAE,CAAC,CAAC;SAC5D;IACH,CAAC;CACF;AA3FD,4BA2FC","sourcesContent":["import type { Address, Hex } from \"@alchemy/aa-core\";\nimport type { Chain } from \"../helpers/chains\";\nimport {\n  type SmartWalletProviderInfo,\n  type AuthProviderInfo,\n} from \"../helpers/constants\";\nimport { SmartWallet } from \"../wallet\";\nimport type { PKPEthersWallet } from \"@lit-protocol/pkp-ethers\";\nimport { SnowballPasskey } from \"../auth/Passkey\";\n\nexport interface SnowballAuth {\n  authProviderInfo: AuthProviderInfo;\n  chain: Chain;\n  isWebAuthnSupported(): boolean;\n  register(username: string): Promise<void>;\n  authenticate(): Promise<void>;\n  getEthersWallet(): Promise<PKPEthersWallet>;\n}\n\nexport interface SnowballSmartWallet {\n  smartWalletProviderInfo: SmartWalletProviderInfo;\n  auth: SnowballAuth;\n  getAddress(): Promise<Address>;\n  sendUserOperation(\n    targetAddress: Address,\n    data: Hex,\n    sponsorGas: Boolean\n  ): Promise<{\n    hash: string;\n  }>;\n}\n\nexport class Snowball {\n  private chain: Chain;\n  private authProviderInfo: AuthProviderInfo;\n  private smartWalletProviderInfo: SmartWalletProviderInfo;\n\n  public auth: SnowballAuth;\n  public smartWallet: SnowballSmartWallet | undefined;\n  public ethersWallet: PKPEthersWallet | undefined;\n\n  constructor(\n    _apiKey: string,\n    chain: Chain,\n    authProviderInfo: AuthProviderInfo,\n    smartWalletProviderInfo: SmartWalletProviderInfo\n  ) {\n    this.chain = chain;\n    this.authProviderInfo = authProviderInfo;\n    this.smartWalletProviderInfo = smartWalletProviderInfo;\n\n    this.auth = new SnowballPasskey(this.chain, this.authProviderInfo);\n    this.getEthersWallet()\n      .then((ethersWallet) => {\n        this.smartWallet = new SmartWallet(\n          ethersWallet,\n          this.auth,\n          this.smartWalletProviderInfo\n        );\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  }\n\n  async getEthersWallet(): Promise<PKPEthersWallet> {\n    try {\n      return await this.auth.getEthersWallet();\n    } catch (error) {\n      return Promise.reject(`getEthersWallet failed ${error}`);\n    }\n  }\n\n  async changeChain(chain: Chain): Promise<void> {\n    try {\n      this.chain = chain;\n      this.auth.chain = chain;\n    } catch (error) {\n      return Promise.reject(`changeChain failed ${error}`);\n    }\n  }\n\n  async getAddress(): Promise<Address> {\n    try {\n      if (this.smartWallet === undefined) {\n        this.ethersWallet = await this.getEthersWallet();\n        this.smartWallet = new SmartWallet(\n          this.ethersWallet,\n          this.auth,\n          this.smartWalletProviderInfo\n        );\n      }\n      return await this.smartWallet.getAddress();\n    } catch (error) {\n      return Promise.reject(`getAddress failed ${error}`);\n    }\n  }\n\n  async sendUserOperation(\n    targetAddress: Address,\n    data: Hex,\n    sponsorGas: Boolean\n  ): Promise<{\n    hash: string;\n  }> {\n    try {\n      if (this.smartWallet === undefined) {\n        this.ethersWallet = await this.getEthersWallet();\n        this.smartWallet = new SmartWallet(\n          this.ethersWallet,\n          this.auth,\n          this.smartWalletProviderInfo\n        );\n      }\n      return await this.smartWallet.sendUserOperation(\n        targetAddress,\n        data,\n        sponsorGas\n      );\n    } catch (error) {\n      return Promise.reject(`sendUserOperation failed ${error}`);\n    }\n  }\n}\n"]}